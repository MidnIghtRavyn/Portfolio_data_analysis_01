<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Novanda Davin Saputra · Portofolio Analisis Asuransi Kesehatan</title>
    <!-- Font Modern & Icons: Plus Jakarta Sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Chart.js 4 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* Variabel tema - dengan peningkatan kontras dan warna lebih cerah untuk dark mode */
        :root {
            --bg-body: #f4f7fc;
            --bg-card: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #1e3a5f;
            --text-muted: #334155;
            --border-light: #dbeafe;
            --accent-blue: #3b82f6;
            --accent-light: #ecf3ff;
            --stat-icon-bg: #e6f0ff;
            --stat-icon-color: #1e4a7a;
            --insight-bg: #f8faff;
            --bullet-bg: #f2f7ff;
            --shadow-color: rgba(0,20,40,0.04);
            --social-bg: #ffffff;
            --badge-bg: #dbeafe;
            --badge-text: #1e3a8a;
            --gradient-start: #0f2b4b;
            --gradient-end: #1e4a7a;
        }

        [data-theme="dark"] {
            --bg-body: #0b1120;
            --bg-card: #1a2635;
            --text-primary: #ffffff;
            --text-secondary: #f1f5f9; /* lebih cerah */
            --text-muted: #e2e8f0; /* lebih cerah */
            --border-light: #475569;
            --accent-blue: #a5d8ff; /* lebih cerah */
            --accent-light: #2d3f57; /* lebih terang */
            --stat-icon-bg: #2d3f57;
            --stat-icon-color: #bbd7fb;
            --insight-bg: #253141;
            --bullet-bg: #2a3749;
            --shadow-color: rgba(0,0,0,0.5);
            --social-bg: #1e2a3a;
            --badge-bg: #2d4b7a;
            --badge-text: #e2f0ff;
            --gradient-start: #5b8ed1;
            --gradient-end: #9ac0fa;
        }

        body {
            background: var(--bg-body);
            font-family: 'Plus Jakarta Sans', 'Inter', sans-serif;
            padding: 2rem 1.8rem;
            color: var(--text-primary);
            line-height: 1.5;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .portfolio-container { max-width: 1440px; margin: 0 auto; }

        /* Header */
        .header {
            margin-bottom: 2.5rem; 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: space-between;
            align-items: center; 
            border-bottom: 2px solid var(--border-light); 
            padding-bottom: 1.2rem;
        }
        .header-left {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }
        .header-left h1 {
            font-weight: 700; 
            font-size: 2rem; 
            letter-spacing: -0.02em;
            background: linear-gradient(145deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .header-left h1 i {
            font-size: 2rem;
            color: var(--accent-blue);
            -webkit-text-fill-color: var(--accent-blue);
            background: none;
            display: inline-block;
        }
        .header-left .sub {
            color: var(--text-secondary); 
            font-size: 0.95rem; 
            display: flex; 
            align-items: center; 
            gap: 0.5rem;
            font-weight: 500;
            margin-left: 0.2rem;
        }
        .header-left .sub i {
            color: var(--accent-blue);
            font-size: 0.9rem;
        }
        
        .header-right { 
            text-align: right; 
        }
        .analyst-name { 
            font-size: 1.4rem; 
            font-weight: 600; 
            color: var(--text-primary); 
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        .analyst-name i { 
            color: var(--accent-blue); 
            font-size: 1.3rem; 
        }
        .badge {
            background: var(--badge-bg); 
            color: var(--badge-text); 
            padding: 0.2rem 0.9rem; 
            border-radius: 30px;
            font-size: 0.75rem; 
            font-weight: 600; 
            display: inline-block; 
            margin-top: 0.2rem;
            letter-spacing: 0.02em;
        }

        /* Stat grid */
        .stat-grid {
            display: grid; 
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem; 
            margin-bottom: 2.5rem;
        }
        .stat-card {
            background: var(--bg-card); 
            padding: 1.5rem 1.2rem; 
            border-radius: 28px;
            box-shadow: 0 8px 20px var(--shadow-color); 
            display: flex; 
            align-items: center; 
            gap: 1rem;
            transition: transform 0.2s ease, box-shadow 0.2s;
            border: 1px solid rgba(59, 130, 246, 0.12);
            animation: fadeUp 0.6s ease backwards;
        }
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 28px -8px rgba(0,70,150,0.15);
            border-color: var(--accent-blue);
        }
        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.15s; }
        .stat-card:nth-child(3) { animation-delay: 0.2s; }
        .stat-card:nth-child(4) { animation-delay: 0.25s; }
        @keyframes fadeUp {
            0% { opacity: 0; transform: translateY(16px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .stat-icon {
            width: 52px;
            height: 52px;
            background: var(--stat-icon-bg);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--stat-icon-color);
            font-size: 1.6rem;
        }
        .stat-content h3 {
            font-size: 2rem; 
            font-weight: 700; 
            line-height: 1.2; 
            color: var(--text-primary);
        }
        .stat-content p { 
            color: var(--text-secondary); 
            font-size: 0.85rem; 
            font-weight: 600;
            text-transform: uppercase; 
            letter-spacing: 0.03em; 
        }

        /* Chart grid */
        .chart-grid {
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 2rem; 
            margin-bottom: 2.5rem;
        }
        .chart-card {
            background: var(--bg-card); 
            border-radius: 32px; 
            padding: 1.6rem 1.5rem 1.4rem 1.5rem;
            box-shadow: 0 18px 36px -12px var(--shadow-color); 
            transition: all 0.25s ease;
            border: 1px solid rgba(59,130,246,0.15);
            animation: cardPop 0.6s ease backwards;
            display: flex;
            flex-direction: column;
        }
        .chart-card:nth-child(1) { animation-delay: 0.15s; }
        .chart-card:nth-child(2) { animation-delay: 0.25s; }
        .chart-card:nth-child(3) { animation-delay: 0.35s; }
        .chart-card:nth-child(4) { animation-delay: 0.45s; }
        @keyframes cardPop {
            0% { opacity: 0; transform: scale(0.96) translateY(8px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }
        .chart-title {
            display: flex; 
            align-items: center; 
            gap: 0.6rem; 
            margin-bottom: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            font-size: 1.1rem;
        }
        .chart-title i {
            color: var(--accent-blue); 
            background: var(--accent-light); 
            padding: 0.45rem; 
            border-radius: 14px;
            font-size: 1rem;
        }
        .chart-container { 
            position: relative; 
            height: 250px; 
            width: 100%; 
            margin-bottom: 0.3rem;
        }

        /* Insight tag */
        .insight-tag {
            margin-top: 1rem; 
            background: var(--insight-bg); 
            border-radius: 18px; 
            padding: 1rem 1.2rem;
            font-size: 0.9rem; 
            color: var(--text-secondary); 
            border-left: 5px solid var(--accent-blue);
            display: flex; 
            gap: 0.8rem; 
            align-items: flex-start;
            line-height: 1.6; 
            box-shadow: 0 2px 6px rgba(0,0,0,0.02);
            font-weight: 500;
        }
        .insight-tag i { 
            color: var(--accent-blue); 
            font-size: 1.1rem; 
            margin-top: 0.1rem; 
        }

        /* Kesimpulan */
        .conclusion-section {
            background: var(--bg-card); 
            border-radius: 32px;
            padding: 2rem 2.2rem; 
            margin-top: 2rem; 
            border: 1px solid var(--border-light);
            box-shadow: 0 16px 32px -12px var(--shadow-color);
            animation: fadeUp 0.7s ease backwards; 
            animation-delay: 0.5s;
        }
        .conclusion-header {
            display: flex; 
            align-items: center; 
            gap: 0.7rem; 
            font-size: 1.3rem;
            font-weight: 700; 
            color: var(--text-primary); 
            margin-bottom: 1.2rem;
        }
        .conclusion-header i {
            color: var(--accent-blue);
        }
        .bullet-list {
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            gap: 1rem; 
            list-style: none; 
            margin-bottom: 1.8rem;
        }
        .bullet-list li {
            display: flex; 
            align-items: center; 
            gap: 0.8rem; 
            background: var(--bullet-bg);
            padding: 0.7rem 1.3rem; 
            border-radius: 50px; 
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .bullet-list li i { color: var(--accent-blue); width: 1.3rem; font-size: 1rem; }
        
        /* Social footer */
        .social-footer {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2.5rem;
            margin: 2.8rem 0 1.8rem;
            flex-wrap: wrap;
        }
        .social-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            background: var(--social-bg);
            padding: 0.9rem 2rem;
            border-radius: 60px;
            box-shadow: 0 8px 18px var(--shadow-color);
            border: 1px solid rgba(59,130,246,0.2);
            transition: all 0.2s ease;
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
        }
        .social-item:hover {
            transform: translateY(-4px);
            border-color: var(--accent-blue);
            box-shadow: 0 16px 26px -8px rgba(31, 95, 200, 0.25);
            background: var(--bg-card);
        }
        .social-item i { font-size: 1.8rem; }
        .github-icon { color: #171515; }
        .pdf-icon { color: #d63e3e; }
        
        /* Signature - sekarang rata kiri mengikuti header */
        .signature {
            display: flex; 
            justify-content: flex-start; /* diubah dari flex-end ke flex-start */
            align-items: center; 
            gap: 1rem;
            border-top: 1px dashed var(--border-light); 
            padding-top: 1.5rem; 
            margin-top: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
        }
        .signature span:first-child {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .signature .name {
            font-size: 1.25rem; 
            font-weight: 700;
            margin-left: auto; /* ini akan mendorong nama ke kanan */
            background: linear-gradient(145deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent;
        }

        /* Dark Mode Toggle */
        .dark-mode-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            background: var(--bg-card);
            border-radius: 60px;
            padding: 12px 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .dark-mode-toggle:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            border-color: var(--accent-blue);
        }
        .toggle-icon {
            font-size: 1.4rem;
            color: var(--accent-blue);
        }
        .toggle-text {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
        }
        .toggle-slider {
            width: 46px;
            height: 24px;
            background: var(--border-light);
            border-radius: 34px;
            position: relative;
            transition: 0.3s;
        }
        .toggle-slider:before {
            content: "";
            position: absolute;
            height: 20px;
            width: 20px;
            left: 2px;
            bottom: 2px;
            background-color: var(--accent-blue);
            border-radius: 50%;
            transition: 0.3s;
        }
        [data-theme="dark"] .toggle-slider:before {
            transform: translateX(22px);
        }

        @media (max-width: 1000px) {
            .stat-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 800px) {
            .chart-grid { grid-template-columns: 1fr; }
            .header { flex-direction: column; align-items: start; gap: 0.8rem; }
            .header-right { text-align: left; width: auto; }
            .signature { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
            .signature .name { margin-left: 0; }
        }
        @media (max-width: 500px) {
            .stat-grid { grid-template-columns: 1fr; }
            body { padding: 1.5rem 1rem; }
            .dark-mode-toggle { bottom: 15px; right: 15px; padding: 8px 15px; }
        }
        .small-note { 
            margin-top: 1.2rem; 
            text-align: center; 
            font-size: 0.85rem; 
            color: var(--text-secondary); 
            font-weight: 500;
        }
    </style>
</head>
<body data-theme="light">
    <!-- Dark Mode Toggle -->
    <div class="dark-mode-toggle" id="darkModeToggle">
        <i class="fas fa-moon toggle-icon" id="toggleIcon"></i>
        <span class="toggle-text" id="toggleText">Mode Gelap</span>
        <div class="toggle-slider" id="toggleSlider"></div>
    </div>

    <div class="portfolio-container">
        <!-- HEADER -->
        <div class="header">
            <div class="header-left">
                <h1>
                    <i class="fas fa-chart-line"></i> 
                    Analisis Asuransi Kesehatan · 2026
                </h1>
                <div class="sub">
                    <i class="fas fa-database"></i> 
                    medical_insurance_2026_kaggle · 1.337 individu · 24 variabel
                </div>
            </div>
            <div class="header-right">
                <div class="analyst-name"><i class="fas fa-user-circle"></i> Novanda Davin Saputra</div>
                <span class="badge"><i class="far fa-clock"></i> portofolio · data analyst</span>
            </div>
        </div>

        <!-- STATISTIK -->
        <div class="stat-grid" id="statGrid">
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-users"></i></div>
                <div class="stat-content">
                    <h3><span class="count-num" id="count1" data-target="1337">0</span></h3>
                    <p>total nasabah</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-smoking"></i></div>
                <div class="stat-content">
                    <h3><span class="count-num" id="count2" data-target="20.5">0</span>%</h3>
                    <p>perokok</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-weight-scale"></i></div>
                <div class="stat-content">
                    <h3><span class="count-num" id="count3" data-target="30.66">0</span></h3>
                    <p>rata‑rata BMI</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                <div class="stat-content">
                    <h3>$<span class="count-num" id="count4" data-target="13279">0</span></h3>
                    <p>rerata charges</p>
                </div>
            </div>
        </div>

        <!-- 4 GRAFIK UTAMA -->
        <div class="chart-grid">
            <div class="chart-card">
                <div class="chart-title"><i class="fas fa-chart-bar"></i> Distribusi Biaya Asuransi</div>
                <div class="chart-container">
                    <canvas id="histChargeChart"></canvas>
                </div>
                <div class="insight-tag"><i class="fas fa-lightbulb"></i> Distribusi menceng ke kanan: mayoritas biaya rendah–menengah, ekor panjang menunjukkan segmen kecil dengan biaya sangat tinggi (>50k). Hal ini mengindikasikan adanya kelompok berisiko tinggi.</div>
            </div>
            <div class="chart-card">
                <div class="chart-title"><i class="fas fa-chart-scatter"></i> Usia vs Biaya Asuransi</div>
                <div class="chart-container">
                    <canvas id="scatterAgeChart"></canvas>
                </div>
                <div class="insight-tag"><i class="fas fa-arrow-up"></i> Korelasi positif: semakin bertambah usia, biaya cenderung naik. Terbentuk tiga klaster — yang tertinggi didominasi perokok. Usia saja tidak cukup menjelaskan variasi; ada faktor lain seperti merokok dan BMI.</div>
            </div>
            <div class="chart-card">
                <div class="chart-title"><i class="fas fa-smoking"></i> Perokok vs Non‑perokok</div>
                <div class="chart-container">
                    <canvas id="smokerGroupChart"></canvas>
                </div>
                <div class="insight-tag"><i class="fas fa-skull"></i> Perokok membayar 4–5 kali lebih tinggi (rata‑rata $24.500 vs $4.950). Varians kelompok perokok sangat besar (std ±12.700) menunjukkan adanya faktor tambahan seperti BMI/usia. Non‑perokok memiliki beberapa pencilan (outlier) biaya tinggi.</div>
            </div>
            <div class="chart-card">
                <div class="chart-title"><i class="fas fa-heart-pulse"></i> BMI vs Biaya (strata perokok)</div>
                <div class="chart-container">
                    <canvas id="bmiSmokerChart"></canvas>
                </div>
                <div class="insight-tag"><i class="fas fa-dumbbell"></i> Pada perokok, kenaikan BMI diikuti lonjakan biaya (kemiringan tajam). Non‑perokok relatif datar. Kombinasi merokok + BMI tinggi menjadi pemicu biaya ekstrem.</div>
            </div>
        </div>

        <!-- KESIMPULAN -->
        <div class="conclusion-section">
            <div class="conclusion-header">
                <i class="fas fa-clipboard-check"></i> Ringkasan & Kesimpulan Analisis
            </div>
            <ul class="bullet-list">
                <li><i class="fas fa-calendar-alt"></i> Usia ↝ biaya naik · korelasi +0,30 (moderat)</li>
                <li><i class="fas fa-fire"></i> Status merokok adalah faktor DOMINAN: korelasi +0,79 dengan biaya</li>
                <li><i class="fas fa-weight"></i> BMI berkontribusi signifikan hanya jika merokok (interaksi risiko)</li>
                <li><i class="fas fa-chart-line"></i> 20,5% perokok menyumbang proporsi biaya tertinggi</li>
                <li><i class="fas fa-people-group"></i> Tidak ada data kosong (missing values) · dataset siap analisis</li>
                <li><i class="fas fa-calculator"></i> Distribusi menceng kanan → perlu penanganan pencilan untuk pemodelan</li>
            </ul>
            <div style="background:var(--accent-light); border-radius: 18px; padding: 1rem 1.3rem; margin: 1.5rem 0 1rem; color: var(--text-primary); font-weight: 500;">
                <span style="font-weight:700; color:var(--accent-blue);"><i class="fas fa-heat-map"></i> Matriks korelasi (hanya numerik):</span> smoker_flag (0,79) > age (0,30) > bmi (0,20) > children (0,07). Variabel lain seperti region tidak berkorelasi signifikan.
            </div>
            
            <!-- SIGNATURE DIPERBAIKI: rata kiri, nama tetap di kanan -->
            <div class="signature">
                <span><i class="far fa-file-code"></i> dashboard interaktif · portofolio analisis data</span>
                <span class="name"><i class="fas fa-pen-nib"></i> Novanda Davin Saputra</span>
            </div>
        </div>

        <!-- GITHUB & DOWNLOAD PDF -->
        <div class="social-footer">
            <a href="https://github.com/novandadavin" target="_blank" class="social-item">
                <i class="fab fa-github github-icon"></i>
                <span>novandadavin</span>
            </a>
            <a href="analysis.pdf" download class="social-item">
                <i class="fas fa-file-pdf pdf-icon"></i>
                <span>Unduh analysis.pdf</span>
            </a>
        </div>

        <div class="small-note">
            <i class="fas fa-chart-line"></i> seluruh visualisasi dianimasikan · dataset: medical_insurance_2026_kaggle · insight sesuai laporan PDF
        </div>
    </div>

    <script>
        (function() {
            // Dark Mode Toggle
            const toggle = document.getElementById('darkModeToggle');
            const icon = document.getElementById('toggleIcon');
            const text = document.getElementById('toggleText');
            const body = document.body;
            
            const savedTheme = localStorage.getItem('theme') || 'light';
            body.setAttribute('data-theme', savedTheme);
            updateToggleUI(savedTheme);
            
            function updateToggleUI(theme) {
                if (theme === 'dark') {
                    icon.className = 'fas fa-sun toggle-icon';
                    text.innerText = 'Mode Terang';
                } else {
                    icon.className = 'fas fa-moon toggle-icon';
                    text.innerText = 'Mode Gelap';
                }
            }
            
            toggle.addEventListener('click', () => {
                const currentTheme = body.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                
                body.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateToggleUI(newTheme);
            });

            // COUNT UP
            const countElements = [
                { element: document.getElementById('count1'), target: 1337, isInteger: true, hasDecimal: false },
                { element: document.getElementById('count2'), target: 20.5, isInteger: false, hasDecimal: true },
                { element: document.getElementById('count3'), target: 30.66, isInteger: false, hasDecimal: true },
                { element: document.getElementById('count4'), target: 13279, isInteger: true, hasDecimal: false }
            ];

            function formatNumber(value, target, isInteger, hasDecimal) {
                if (hasDecimal) {
                    if (target === 20.5) return value.toFixed(1);
                    if (target === 30.66) return value.toFixed(2);
                    return value.toFixed(1);
                } else {
                    return Math.floor(value).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                }
            }

            function startCountUp(item) {
                const element = item.element;
                const target = item.target;
                const isInteger = item.isInteger;
                const hasDecimal = item.hasDecimal;
                
                let current = 0;
                const duration = 2000;
                const startTime = performance.now();
                
                function updateCount(currentTime) {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    
                    current = target * progress;
                    
                    if (hasDecimal) {
                        if (target === 20.5) {
                            element.innerText = current.toFixed(1);
                        } else if (target === 30.66) {
                            element.innerText = current.toFixed(2);
                        } else {
                            element.innerText = current.toFixed(1);
                        }
                    } else {
                        const intValue = Math.floor(current);
                        element.innerText = intValue.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                    }
                    
                    if (progress < 1) {
                        requestAnimationFrame(updateCount);
                    } else {
                        if (hasDecimal) {
                            if (target === 20.5) element.innerText = '20.5';
                            else if (target === 30.66) element.innerText = '30.66';
                            else element.innerText = target.toFixed(1);
                        } else {
                            element.innerText = target.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                        }
                    }
                }
                
                requestAnimationFrame(updateCount);
            }

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const element = entry.target;
                        const item = countElements.find(item => item.element === element);
                        if (item) {
                            startCountUp(item);
                            observer.unobserve(element);
                        }
                    }
                });
            }, { threshold: 0.2 });

            countElements.forEach(item => {
                if (item.element) {
                    observer.observe(item.element);
                }
            });

            // CHARTS
            const chargeBins = ['0-5k', '5k-12k', '12k-20k', '20k-35k', '>35k'];
            const chargeCounts = [480, 420, 240, 140, 57];

            function generateAgeScatter() {
                let points = [];
                for (let i=0; i<24; i++) {
                    let age = 18 + Math.floor(Math.random() * 47);
                    let base = 2000 + age * 100 + Math.random()*3000;
                    points.push({x: age, y: Math.min(base, 30000)});
                }
                for (let i=0; i<14; i++) {
                    let age = 23 + Math.floor(Math.random() * 42);
                    let base = 14000 + age * 270 + Math.random()*9000;
                    points.push({x: age, y: Math.min(base, 62000)});
                }
                points.push({x: 60, y: 37000}, {x: 55, y: 29000}, {x: 63, y: 41000}, {x: 50, y: 18500});
                return points.sort((a,b) => a.x - b.x);
            }
            const scatterData = generateAgeScatter();
            const smokerAvg = [4950, 24500];

            function bmiPoints(isSmoker) {
                let pts = [];
                let count = isSmoker ? 13 : 22;
                for (let i=0; i<count; i++) {
                    let bmi = 16 + Math.random() * 38;
                    let charge;
                    if (isSmoker) {
                        charge = 11000 + bmi * 520 + (Math.random()*8000);
                    } else {
                        charge = 1800 + bmi * 70 + (Math.random()*3500);
                    }
                    pts.push({x: parseFloat(bmi.toFixed(1)), y: Math.min(charge, 63000)});
                }
                return pts.sort((a,b) => a.x - b.x);
            }
            const nonSmokerBMI = bmiPoints(false);
            const smokerBMI = bmiPoints(true);

            new Chart(document.getElementById('histChargeChart'), {
                type: 'bar',
                data: {
                    labels: chargeBins,
                    datasets: [{
                        label: 'frekuensi', data: chargeCounts, backgroundColor: '#5790c4',
                        borderRadius: 8, barPercentage: 0.7,
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, animation: { duration: 1400, easing: 'easeOutQuart' }, plugins: { legend: { display: false } } }
            });

            new Chart(document.getElementById('scatterAgeChart'), {
                type: 'scatter',
                data: { datasets: [{ label: 'individu', data: scatterData, backgroundColor: '#3271ae', pointRadius: 5, pointHoverRadius: 8 }] },
                options: { responsive: true, maintainAspectRatio: false, animation: { duration: 1500 }, scales: { x: { title: { display: true, text: 'Usia (tahun)' } }, y: { title: { display: true, text: 'Charges ($)' }, beginAtZero: true } }, plugins: { legend: { display: false } } }
            });

            new Chart(document.getElementById('smokerGroupChart'), {
                type: 'bar',
                data: { labels: ['Non‑perokok', 'Perokok'], datasets: [{ label: 'Rata-rata charges ($)', data: smokerAvg, backgroundColor: ['#81a9d3', '#d97c7c'], borderRadius: 8 }] },
                options: { responsive: true, maintainAspectRatio: false, animation: { duration: 1200 }, plugins: { tooltip: { callbacks: { label: (ctx) => `$${ctx.raw.toLocaleString()}` } } }, scales: { y: { beginAtZero: true } } }
            });

            new Chart(document.getElementById('bmiSmokerChart'), {
                type: 'scatter',
                data: { datasets: [ { label: 'Non‑perokok', data: nonSmokerBMI, backgroundColor: '#3b7bb7', pointRadius: 5 }, { label: 'Perokok', data: smokerBMI, backgroundColor: '#c45a5a', pointRadius: 5 } ] },
                options: { responsive: true, maintainAspectRatio: false, animation: { duration: 1600 }, scales: { x: { title: { display: true, text: 'BMI' } }, y: { title: { display: true, text: 'Charges ($)' } } } }
            });
        })();
    </script>
</body>
</html>